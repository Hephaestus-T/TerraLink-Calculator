<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Mortgage Affordability Calculator</title>
  <style>
    :root {
      --navy:    #1e2d5c;
      --orange:  #F5A623;
      --green:   #2c9c7a;
      --red:     #d9534f;
      --bg-gray: #f7f9fc;
      --text-lt: #555;
    }
    body {
      margin:0; padding:20px;
      background:var(--bg-gray);
      color:var(--navy);
      font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    .container {
      max-width:900px;
      margin:auto;
    }
    h1 { text-align:center; font-size:2rem; margin-bottom:30px; }
    h2 { color:var(--navy); font-size:1.4rem; margin-bottom:15px; }
    h3.section {
      margin:0 0 10px;
      font-size:1.2rem;
      color:var(--navy);
      border-bottom:3px solid var(--orange);
      padding-bottom:4px;
    }
    .card {
      background:#fff;
      border-radius:8px;
      padding:20px;
      box-shadow:0 2px 6px rgba(0,0,0,0.1);
      margin-bottom:20px;
    }
    .form-row {
      display:flex; flex-wrap:wrap; align-items:center;
      margin-bottom:12px;
    }
    .form-row label {
      width:140px; min-width:120px; font-weight:500;
    }
    .form-row input, .form-row select {
      flex:1; padding:8px;
      border:1px solid #ccc; border-radius:4px;
      font-size:0.95rem;
    }
    .button-add, .button-small {
      background:var(--orange); color:#fff;
      border:none; border-radius:4px;
      cursor:pointer; font-size:0.9rem;
      padding:8px 12px; margin-top:10px;
    }
    .button-small {
      background:var(--navy); padding:6px 10px;
      font-size:0.85rem; margin-left:10px;
    }
    .button-add:hover, .button-small:hover { opacity:0.9; }
    .monthly-display { margin-left:auto; font-weight:bold; color:var(--green); }
    #total-income { font-size:1.6rem; color:var(--green); font-weight:bold; }
    #equation { text-align:center; font-size:1.5rem; margin:20px 0; }
    #chart-container {
      display:flex; align-items:center; gap:20px; flex-wrap:wrap;
      justify-content:center;
    }
    #breakdown-chart {
      max-width:250px; max-height:250px;
    }
    #chart-legend {
      list-style:none; padding:0; margin:0;
    }
    #chart-legend li {
      display:flex; align-items:center; margin-bottom:6px;
      font-size:0.95rem; color:var(--navy);
    }
    .dot {
      width:12px; height:12px; border-radius:50%;
      display:inline-block; margin-right:8px;
    }
    #affordability-explanation {
      color:var(--text-lt); font-size:0.95rem; margin-top:10px;
    }
    #affordability-result {
      margin-top:8px; font-size:1.1rem; font-weight:bold;
    }
    @media(max-width:768px){
      .form-row { flex-direction:column; align-items:flex-start; }
      .form-row label { width:auto; margin-bottom:4px; }
      #equation { font-size:1.3rem; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Mortgage Affordability Calculator</h1>

    <!-- Income Card -->
    <div class="card" id="income-section">
      <h2>Income</h2>
      <div id="employers-container"></div>
      <button id="add-employer-btn" class="button-add">+ Add Another Employer</button>

      <h3 class="section">Other Income</h3>
      <div id="other-income-container"></div>
      <button id="add-other-income-btn" class="button-add">+ Add Another Income Source</button>

      <div class="form-row">
        <label>Total Monthly Income:</label>
        <span id="total-income">$0.00</span>
      </div>
    </div>

    <!-- Expenses Card -->
    <div class="card" id="expenses-section">
      <h2>Expenses</h2>
      <div id="expenses-container"></div>
      <button id="add-expense-btn" class="button-add">+ Add Expense</button>
      <div id="expense-selector" class="form-row" style="display:none;">
        <select id="expense-type-select">
          <option value="car">Car Payment</option>
          <option value="credit">Credit Card</option>
          <option value="loan">Loan</option>
        </select>
        <button id="expense-type-confirm-btn" class="button-small">Add</button>
      </div>
    </div>

    <!-- Summary Equation -->
    <div class="card">
      <h2>Summary</h2>
      <div id="equation">$0.00 − $0.00 = $0.00</div>
    </div>

    <!-- Affordability Check -->
    <div class="card">
      <h2>Affordability Check</h2>
      <div class="form-row">
        <label>Desired Mortgage:</label>
        <input type="number" id="mortgage-input" placeholder="Enter $/mo" min="0" step="0.01">
        <button id="check-afford-btn" class="button-small">Check</button>
      </div>
      <div id="chart-container">
        <canvas id="breakdown-chart" width="200" height="200"></canvas>
        <ul id="chart-legend"></ul>
      </div>
      <div id="affordability-explanation"></div>
      <div id="affordability-result"></div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // DOM refs + state
      const empCont    = document.getElementById('employers-container'),
            addEmpBtn  = document.getElementById('add-employer-btn'),
            othIncCont = document.getElementById('other-income-container'),
            addOthBtn  = document.getElementById('add-other-income-btn'),
            expCont    = document.getElementById('expenses-container'),
            addExpBtn  = document.getElementById('add-expense-btn'),
            expSel     = document.getElementById('expense-selector'),
            expTypeSel = document.getElementById('expense-type-select'),
            expConfirm = document.getElementById('expense-type-confirm-btn'),
            legendEl   = document.getElementById('chart-legend'),
            canvas     = document.getElementById('breakdown-chart'),
            ctx        = canvas.getContext('2d');

      let employerCount = 0, maxEmp = 4,
          otherCount    = 0,
          expCount      = {car:0, credit:0, loan:0},
          expLimit      = {car:2, credit:10, loan:10};

      // Helpers
      function addEmployer(){
        if(employerCount>=maxEmp) return;
        employerCount++;
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <h3 class="section">Employer ${employerCount}</h3>
          <div class="form-row">
            <label>Hourly Rate ($):</label>
            <input type="number" class="hourly-rate" min="0" step="0.01">
          </div>
          <div class="form-row">
            <label>Hours/Week:</label>
            <input type="number" class="hours-per-week" min="0" step="0.1">
          </div>
          <div class="form-row">
            <label>Monthly Income:</label>
            <span class="monthly-display">$0.00</span>
          </div>`;
        empCont.appendChild(card);
        if(employerCount===maxEmp) addEmpBtn.disabled=true;
      }

      function addOther(){
        otherCount++;
        const r=document.createElement('div');
        r.className='form-row';
        r.innerHTML=`
          <select class="other-income-type">
            <option>Social Security</option>
            <option>Retirement</option>
            <option>Disability</option>
            <option>Alimony</option>
            <option>Other Income</option>
          </select>
          <input type="number" class="other-income-input" placeholder="Monthly Amount" min="0" step="0.01">`;
        othIncCont.appendChild(r);
      }

      function addStaticExpense(label,id){
        const card=document.createElement('div');
        card.className='card';
        card.innerHTML=`
          <h3 class="section">${label}</h3>
          <div class="form-row">
            <label>Amount:</label>
            <input type="number" id="${id}-input" class="expense-input" placeholder="Monthly ${label}" min="0" step="0.01">
          </div>`;
        expCont.appendChild(card);
      }

      function addExpense(type){
        if(expCount[type]>=expLimit[type]) return;
        expCount[type]++;
        const lbl=type==='car'?'Car Payment':type==='credit'?'Credit Card':'Loan';
        const card=document.createElement('div');
        card.className='card';
        card.innerHTML=`
          <h3 class="section">${lbl} ${expCount[type]}</h3>
          <div class="form-row">
            <label>Amount:</label>
            <input type="number" class="expense-input" placeholder="Monthly ${lbl}" min="0" step="0.01">
          </div>`;
        expCont.appendChild(card);
        if(expCount[type]===expLimit[type])
          expTypeSel.querySelector(`option[value="${type}"]`).disabled=true;
      }

      // init fields
      addEmployer(); addOther();
      addStaticExpense('Rent','rent');
      addExpense('car'); addExpense('credit'); addExpense('loan');
      addStaticExpense('Child Support','child-support');
      addStaticExpense('Medical Bills','medical-bills');

      // events
      addEmpBtn.addEventListener('click',addEmployer);
      addOthBtn.addEventListener('click',addOther);
      addExpBtn.addEventListener('click',()=>expSel.style.display='flex');
      expConfirm.addEventListener('click',()=>{
        addExpense(expTypeSel.value);
        expSel.style.display='none';
      });
      document.body.addEventListener('input',updateTotals);
      document.getElementById('check-afford-btn').addEventListener('click',checkAfford);

      // calculations
      function updateTotals(){
        // total income
        let totalEmp=0;
        empCont.querySelectorAll('.card').forEach(c=>{
          const r=c.querySelector('.hourly-rate').valueAsNumber||0,
                h=c.querySelector('.hours-per-week').valueAsNumber||0,
                m=r*h*52/12;
          totalEmp+=m;
          c.querySelector('.monthly-display').textContent=`$${m.toFixed(2)}`;
        });
        let totalOther=0;
        othIncCont.querySelectorAll('.other-income-input')
          .forEach(i=> totalOther+=i.valueAsNumber||0);
        const totalIncome=totalEmp+totalOther;
        document.getElementById('total-income').textContent=`$${totalIncome.toFixed(2)}`;

        // total debt
        let totalDebt=0;
        expCont.querySelectorAll('.expense-input')
          .forEach(i=> totalDebt+=i.valueAsNumber||0);

        // equation
        const disp=totalIncome-totalDebt;
        document.getElementById('equation').textContent=
          `$${totalIncome.toFixed(2)} − $${totalDebt.toFixed(2)} = $${disp.toFixed(2)}`;
      }

      function checkAfford(){
        updateTotals();
        const rentVal = parseFloat(document.getElementById('rent-input').value)||0;
        const eqTxt   = document.getElementById('equation').textContent;
        const [ , incStr, debtStr, dispStr ] = eqTxt.match(/\$([\d.,]+) − \$([\d.,]+) = \$([\d.,]+)/);
        const dispVal = parseFloat(dispStr.replace(/,/g,''))||0;
        const mortgage= document.getElementById('mortgage-input').valueAsNumber||0;

        const extra = Math.max(mortgage - rentVal, 0);
        const spare = dispVal - extra;

        // explanation
        document.getElementById('affordability-explanation').textContent =
          `You already pay $${rentVal.toFixed(2)} in rent. ` +
          `To cover a $${mortgage.toFixed(2)} mortgage you’d use $${extra.toFixed(2)} ` +
          `from your disposable income, leaving you $${spare.toFixed(2)} to spare.`;

        // result
        const resEl = document.getElementById('affordability-result');
        if(mortgage <= rentVal + dispVal){
          resEl.textContent = '✅ You could afford this!';
          resEl.style.color = 'var(--green)';
        } else {
          resEl.textContent = '⚠️ This may stretch your current income.';
          resEl.style.color = 'var(--red)';
        }

        // draw donut + legend
        drawChart(rentVal, extra, spare, mortgage);
      }

      function drawChart(rent, extra, spare, mortgage){
        const data  = [rent, extra, spare].map(v=> Math.max(v,0));
        const total = data.reduce((a,b)=>a+b,0);
        const colors= [getComputedStyle(document.documentElement).getPropertyValue('--red').trim(),
                       getComputedStyle(document.documentElement).getPropertyValue('--orange').trim(),
                       getComputedStyle(document.documentElement).getPropertyValue('--green').trim()];
        const labels= ['Rent','Toward Mortgage','Leftover'];

        // clear canvas & legend
        ctx.clearRect(0,0,canvas.width,canvas.height);
        legendEl.innerHTML = '';

        if(total <= 0) return;

        let start = -0.5*Math.PI;
        const cx = canvas.width/2, cy = canvas.height/2, radius = Math.min(cx,cy) - 20;
        ctx.lineWidth = 20;

        // arcs
        data.forEach((val,i)=>{
          const slice = val/total * 2*Math.PI;
          ctx.beginPath();
          ctx.strokeStyle = colors[i];
          ctx.arc(cx, cy, radius, start, start + slice);
          ctx.stroke();
          // legend item
          const pct = (val/total*100).toFixed(0);
          const li = document.createElement('li');
          li.innerHTML = `<span class="dot" style="background:${colors[i]}"></span>
                          ${labels[i]} $${val.toFixed(2)} (${pct}%)`;
          legendEl.appendChild(li);
          start += slice;
        });

        // center text
        ctx.fillStyle = varGet('--navy');
        ctx.font = 'bold 16px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText('Monthly', cx, cy - 8);
        ctx.fillText('Mortgage', cx, cy + 10);
        ctx.fillStyle = varGet('--navy');
        ctx.font = 'bold 18px sans-serif';
        ctx.fillText(`$${mortgage.toFixed(0)}`, cx, cy + 32);
      }

      function varGet(name){
        return getComputedStyle(document.documentElement).getPropertyValue(name).trim();
      }

      // initial
      updateTotals();
    });
  </script>
</body>
</html>
