<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TerraLink Affordability Wizard</title>
  <link
    href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Lato:wght@400;600&display=swap"
    rel="stylesheet"
  />
  <style>
    :root {
      --navy:    #1e2d5c;
      --green:   #2c9c7a;
      --red:     #d9534f;
      --yellow:  #f0ad4e;
      --bg-gray: #f7f9fc;
      --text:    #333;
    }
    * { box-sizing: border-box; }
    body {
      margin:0; padding:20px;
      background: var(--bg-gray);
      color: var(--navy);
      font-family: Lato, sans-serif;
    }
    h1 {
      font-family:'Playfair Display',serif;
      font-size:2rem;  /* reduced from 2.5 */
      text-align:center;
      margin-bottom:30px;
    }

    .wizard { max-width:800px; margin:0 auto; overflow:hidden; }

    .wizard-progress {
      display:flex; margin-bottom:30px;
    }
    .wizard-step {
      flex:1; text-align:center; padding:8px 0;
      font-family:'Playfair Display',serif;
      font-size:1rem; color:var(--text);
      cursor:pointer; position:relative;
    }
    .wizard-step.active {
      color:var(--navy); font-weight:700;
    }
    .wizard-step.active::after {
      content:''; position:absolute;
      bottom:0; left:25%; right:25%;
      height:3px; background:var(--green);
      border-radius:2px;
    }

    .wizard-panels {
      display:flex; width:400%; transition:transform .5s ease;
    }
    .panel { flex:1; padding:30px 20px; }

    .card {
      background:#fff; border-radius:12px;
      box-shadow:0 4px 12px rgba(0,0,0,0.04);
      padding:20px; margin-bottom:30px;
    }
    .section-title {
      font-family:'Playfair Display',serif;
      font-size:1.4rem; margin-bottom:16px;
      border-bottom:2px solid var(--green);
      padding-bottom:6px;
    }

    .form-row {
      display:flex; flex-wrap:wrap; align-items:center;
      margin-bottom:20px;
    }
    .form-row label {
      min-width:120px;
      font-weight:600; color:var(--text);
    }
    .form-row input,
    .form-row select {
      flex:1; padding:10px;
      border:none; border-bottom:2px solid #ccc;
      font-size:16px;  /* prevent mobile zoom */
      transition:border-color .3s,box-shadow .3s;
    }
    .form-row input:focus,
    .form-row select:focus {
      outline:none;
      border-bottom-color:var(--green);
      box-shadow:0 2px 6px rgba(44,156,122,0.3);
    }

    .btn {
      display:inline-block; padding:12px 20px;
      border:none; border-radius:8px;
      font-size:1rem; font-weight:600;
      cursor:pointer; margin-top:20px;
      transition:background .3s,transform .2s;
    }
    .btn-gold { background:var(--green); color:#fff; }
    .btn-gold:hover { transform:translateY(-2px); }
    .btn-navy { background:var(--navy); color:#fff; }
    .btn-navy:hover { transform:translateY(-2px); }

    #add-employer-btn,
    #add-other-income-btn,
    #add-expense-btn {
      margin-bottom:30px;
    }

    .monthly-display {
      margin-left:auto; font-weight:700;
      font-size:1.1rem; color:var(--green);
    }
    #total-income {
      margin-top:12px;
      font-size:2.5rem; color:var(--green);
      font-weight:700;
    }

    .expense-total-row {
      margin-top:20px; border-top:1px dashed #ddd;
      padding-top:16px;
    }
    #total-expenses {
      margin-left:auto; font-weight:700;
      font-size:2.5rem; color:var(--red);
    }

    /* Summary */
    #equation {
      display:flex; flex-direction:column;
      align-items:flex-start;
      margin:30px 0;
    }
    .eq-row {
      display:flex; justify-content:space-between;
      width:100%; margin-bottom:16px;
      font-size:1.5rem;
    }
    .eq-row span:last-child { font-weight:700; }
    #eq-income { color:var(--green); }
    #eq-exp    { color:var(--red);   }
    #eq-disp   { /* dynamic */      }

    #budget-health {
      font-size:1.1rem; color:var(--red);
      text-align:left; margin-bottom:20px;
    }

    .btn-copy {
      display:flex; align-items:center;
      gap:8px; padding:10px 16px; margin-bottom:30px;
      border:2px solid var(--navy);
      border-radius:6px; background:#fff;
      color:var(--navy); font-size:1rem;
      cursor:pointer;
      transition:background .3s,color .3s,transform .2s;
    }
    .btn-copy:hover {
      background:var(--navy); color:#fff;
      transform:translateY(-2px);
    }

    .btn-row {
      display:flex; justify-content:space-between;
      margin-top:20px;
    }

    #chart-container {
      display:flex; flex-wrap:wrap; align-items:center;
      justify-content:center; gap:24px; margin-top:30px;
    }
    #breakdown-chart { width:220px; height:220px; }
    #chart-legend { list-style:none; padding:0; margin:0; }
    #chart-legend li {
      display:flex; align-items:center; margin-bottom:8px;
      font-size:1rem;
    }
    .dot { width:12px; height:12px; border-radius:50%; margin-right:8px; }

    /* Responsive */
    @media (max-width:480px) {
      h1 { font-size:2rem; }
      .wizard-progress { display:none; }
      .form-row { flex-direction:column; align-items:stretch; }
      .form-row label { margin-bottom:6px; }
      .eq-row {
        flex-direction:column; align-items:flex-start;
        font-size:1.3rem; margin-bottom:12px;
      }
      #eq-income,#eq-exp,#eq-disp { font-size:1.6rem; }
      #total-income,#total-expenses { font-size:2rem; }
    }
    @media (min-width:769px) {
      body { padding:40px; }
      h1 { font-size:2.5rem; }
      .section-title { font-size:1.6rem; }
    }
  </style>
</head>
<body>
  <div class="wizard">
    <h1>Find Your Path to Homeownership</h1>

    <div class="wizard-progress">
      <div class="wizard-step" data-step="0">1. Income</div>
      <div class="wizard-step" data-step="1">2. Expenses</div>
      <div class="wizard-step" data-step="2">3. Summary</div>
      <div class="wizard-step" data-step="3">4. Mortgage</div>
    </div>

    <div class="wizard-panels">

      <!-- STEP 1: Income -->
      <section class="panel">
        <div class="section-title">Let‚Äôs figure out your monthly income</div>
        <div id="employers-container"></div>
        <button class="btn btn-gold" id="add-employer-btn">+ Add Employer</button>

        <div class="section-title">Other Income</div>
        <div id="other-income-container"></div>
        <button class="btn btn-gold" id="add-other-income-btn">+ Add Income</button>

        <div class="form-row">
          <label>Total Monthly Income:</label>
          <div id="total-income">$0.00</div>
        </div>

        <button class="btn btn-gold next-btn">Next ‚Üí</button>
      </section>

      <!-- STEP 2: Expenses -->
      <section class="panel">
        <div class="section-title">Let‚Äôs figure out your monthly expenses</div>
        <div id="expenses-container"></div>
        <button class="btn btn-gold" id="add-expense-btn">+ Add Expense</button>
        <div id="expense-selector" class="form-row" style="display:none;">
          <select id="expense-type-select">
            <option value="rent">Rent</option>
            <option value="car">Car Payment</option>
            <option value="credit">Credit Card</option>
            <option value="loan">Loan</option>
          </select>
          <button class="btn btn-navy" id="expense-type-confirm-btn">Add</button>
        </div>
        <div class="expense-total-row form-row">
          <label>Total Monthly Expenses:</label>
          <div id="total-expenses">$0.00</div>
        </div>
        <button class="btn prev-btn">‚Üê Back</button>
        <button class="btn btn-gold next-btn">Next ‚Üí</button>
      </section>

      <!-- STEP 3: Summary -->
      <section class="panel">
        <div class="section-title">Your Disposable Income</div>

        <div id="equation">
          <div class="eq-row">
            <span>Monthly Income</span>
            <span id="eq-income">$0.00</span>
          </div>
          <div class="eq-row">
            <span>‚Äì Monthly Expenses</span>
            <span id="eq-exp">$0.00</span>
          </div>
          <div class="eq-row">
            <span>= Disposable Income</span>
            <span id="eq-disp">$0.00</span>
          </div>
        </div>

        <div id="budget-health"></div>
        <button id="copy-btn" class="btn-copy">üìã Copy for reference</button>

        <div class="btn-row">
          <button class="btn prev-btn">‚Üê Back</button>
          <button class="btn btn-gold next-btn">Next ‚Üí</button>
        </div>
      </section>

      <!-- STEP 4: Mortgage -->
      <section class="panel">
        <div class="section-title">Do you have a target mortgage payment?</div>

        <div class="form-row">
          <label>Desired Mortgage:</label>
          <input type="number" id="mortgage-input" placeholder="$ / mo" min="0" step="0.01">
        </div>

        <button class="btn btn-navy" id="check-afford-btn">Check</button>

        <div id="chart-container">
          <canvas id="breakdown-chart"></canvas>
          <ul id="chart-legend"></ul>
        </div>

        <div id="affordability-explanation"></div>
        <div id="affordability-result"></div>

        <button class="btn prev-btn">‚Üê Back</button>
      </section>

    </div>
  </div>

  <script>
    // formatting helper
    function fmt(n){ return n.toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2}); }
    function cssVar(v){ return getComputedStyle(document.documentElement).getPropertyValue(v).trim(); }

    document.addEventListener('DOMContentLoaded',()=>{
      // STEP NAV
      const steps=[...document.querySelectorAll('.wizard-step')],
            panels=document.querySelector('.wizard-panels');
      let cur=0;
      function show(i){
        cur=i;
        panels.style.transform = `translateX(-${(i*100)/steps.length}%)`;
        steps.forEach((s,j)=> s.classList.toggle('active', j===i) );
        // always scroll top of panel
        panels.children[i].scrollTo(0,0);
      }
      steps.forEach(s=> s.onclick=()=> show(+s.dataset.step) );
      document.querySelectorAll('.next-btn').forEach(b=>b.onclick=()=>show(Math.min(cur+1,3)));
      document.querySelectorAll('.prev-btn').forEach(b=>b.onclick=()=>show(Math.max(cur-1,0)));
      show(0);

      // INCOME STEP
      let empCount=0, maxEmp=4;
      const empC=document.getElementById('employers-container'),
            addEmp=document.getElementById('add-employer-btn');
      addEmp.onclick = ()=>{
        if(empCount>=maxEmp) return;
        empCount++;
        const card=document.createElement('div'); card.className='card';
        card.innerHTML=`
          <div class="section-title">Employer ${empCount}</div>
          <div class="form-row"><label>Pay Type:</label>
            <select class="pay-type"><option value="hourly">Hourly</option><option value="salary">Salaried</option></select>
          </div>
          <div class="form-row hourly-row">
            <label>Hourly Rate ($):</label><input type="number" class="hourly-rate" min="0" step="0.01">
          </div>
          <div class="form-row hourly-row">
            <label>Hours/Week:</label><input type="number" class="hours-per-week" min="0" step="0.1">
          </div>
          <div class="form-row salary-row" style="display:none;">
            <label>Annual Salary ($):</label><input type="number" class="annual-salary" min="0" step="0.01">
          </div>
          <div class="form-row">
            <label>Monthly Income:</label><span class="monthly-display">$0.00</span>
          </div>`;
        empC.appendChild(card);

        const payType = card.querySelector('.pay-type'),
              hourlyRows = [...card.querySelectorAll('.hourly-row')],
              salaryRow  = card.querySelector('.salary-row');
        payType.onchange = ()=>{
          if(payType.value==='hourly'){
            hourlyRows.forEach(r=>r.style.display='flex');
            salaryRow.style.display='none';
          } else {
            hourlyRows.forEach(r=>r.style.display='none');
            salaryRow.style.display='flex';
          }
          updateTotals();
        };
        // any input change -> recalc
        card.querySelectorAll('input').forEach(i=> i.addEventListener('input', updateTotals) );
      };
      addEmp.click();

      // OTHER INCOME
      const othC=document.getElementById('other-income-container'),
            addO=document.getElementById('add-other-income-btn');
      addO.onclick = ()=>{
        const row=document.createElement('div'); row.className='form-row';
        row.innerHTML=`
          <select class="other-income-type">
            <option>Social Security</option><option>Retirement</option>
            <option>Disability</option><option>Alimony</option><option>Other</option>
          </select>
          <input type="number" class="other-income-input" placeholder="Monthly Amount" min="0" step="0.01">`;
        othC.appendChild(row);
        row.querySelector('input').addEventListener('input', updateTotals);
      };
      addO.click();

      // EXPENSES STEP
      const expC=document.getElementById('expenses-container'),
            addX=document.getElementById('add-expense-btn'),
            selX=document.getElementById('expense-selector'),
            tX=document.getElementById('expense-type-select'),
            cX=document.getElementById('expense-type-confirm-btn');
      const counts={rent:0,car:0,credit:0,loan:0}, limits={rent:1,car:2,credit:10,loan:10};
      function makeExpense(type){
        if(counts[type]>=limits[type]) return;
        counts[type]++;
        let label=type.charAt(0).toUpperCase()+type.slice(1);
        if(type==='credit') label='Credit Card';
        const card=document.createElement('div'); card.className='card';
        card.innerHTML=`
          <div class="section-title">${label}${counts[type]>1?' '+counts[type]:''}</div>
          <div class="form-row"><label>Amount:</label>
            <input type="number" class="expense-input" placeholder="Monthly ${label}" min="0" step="0.01"></div>`;
        expC.appendChild(card);
        if(++counts[type]===limits[type]) {
          selX.querySelector(`option[value="${type}"]`).disabled=true;
        }
        card.querySelector('input').addEventListener('input', updateTotals);
      }
      // always have rent in there
      makeExpense('rent');
      makeExpense('car');
      makeExpense('credit');
      makeExpense('loan');

      addX.onclick = ()=> selX.style.display='flex';
      cX.onclick = ()=>{
        makeExpense(tX.value);
        selX.style.display='none';
      };

      // SHARED ELEMENTS
      const tiEl=document.getElementById('total-income'),
            teEl=document.getElementById('total-expenses'),
            eInc=document.getElementById('eq-income'),
            eExp=document.getElementById('eq-exp'),
            eDisp=document.getElementById('eq-disp'),
            budH=document.getElementById('budget-health'),
            copyB=document.getElementById('copy-btn'),
            mtIn=document.getElementById('mortgage-input'),
            chkB=document.getElementById('check-afford-btn'),
            cnv=document.getElementById('breakdown-chart'),
            lg=document.getElementById('chart-legend'),
            exEl=document.getElementById('affordability-explanation'),
            rEl=document.getElementById('affordability-result'),
            ctx=cnv.getContext('2d');

      // recalc all totals
      function updateTotals(){
        // income
        let totalInc=0;
        document.querySelectorAll('.card').forEach(card=>{
          if(!card.querySelector('.monthly-display')) return;
          const payType=card.querySelector('.pay-type').value;
          let monthly=0;
          if(payType==='hourly'){
            const rate=+card.querySelector('.hourly-rate').value||0,
                  hrs =+card.querySelector('.hours-per-week').value||0;
            monthly = rate*hrs*52/12;
          } else {
            const ann =+card.querySelector('.annual-salary').value||0;
            monthly = ann/12;
          }
          totalInc += monthly;
          card.querySelector('.monthly-display').textContent='$'+fmt(monthly);
        });
        // other income
        document.querySelectorAll('.other-income-input')
          .forEach(i=> totalInc += +i.value || 0);
        tiEl.textContent = '$'+fmt(totalInc);

        // expenses
        let totalExp=0;
        document.querySelectorAll('.expense-input')
          .forEach(i=> totalExp += +i.value || 0);
        teEl.textContent = '$'+fmt(totalExp);

        // summary equation
        const disp = totalInc - totalExp;
        eInc.textContent = '$'+fmt(totalInc);
        eExp.textContent = '$'+fmt(totalExp);
        eDisp.textContent= '$'+fmt(disp);
        eDisp.style.color = disp < 600 ? cssVar('--red') : cssVar('--green');
        budH.textContent = disp < 600
          ? '‚ö†Ô∏è Your disposable income is under $600‚Ää/mo. Consider reducing debts or increasing income.'
          : '';
        return {ti:totalInc, te:totalExp, disp};
      }

      // copy to clipboard
      copyB.onclick = ()=>{
        const txt = `Income ${eInc.textContent}\nExpenses ${eExp.textContent}\nDisposable ${eDisp.textContent}`;
        navigator.clipboard.writeText(txt);
        copyB.textContent='‚úÖ Copied!';
        copyB.disabled=true;
        setTimeout(()=>{
          copyB.textContent='üìã Copy for reference';
          copyB.disabled=false;
        },1500);
      };

      // draw the donut
      function drawChart(rent,toward,leftover,mtg){
        const data=[rent,toward,leftover],
              total=data.reduce((a,b)=>a+b,0),
              cols=[cssVar('--red'),cssVar('--yellow'),cssVar('--green')],
              labs=['Rent','Toward Mortgage','Leftover'];
        ctx.clearRect(0,0,300,300);
        lg.innerHTML='';
        if(total===0) return;
        let start=-.5*Math.PI, cx=110, cy=110, rad=90;
        ctx.lineWidth=20;
        data.forEach((v,i)=>{
          const slice=v/total*2*Math.PI;
          ctx.beginPath();
          ctx.strokeStyle=cols[i];
          ctx.arc(cx,cy,rad,start,start+slice);
          ctx.stroke();
          start+=slice;
          const pct = ((v/total)*100).toFixed(0);
          const li=document.createElement('li');
          li.innerHTML=`<span class="dot" style="background:${cols[i]}"></span>
                        ${labs[i]} $${fmt(v)} (${pct}%)`;
          lg.appendChild(li);
        });
        ctx.fillStyle=cssVar('--navy');
        ctx.textAlign='center';
        ctx.font='600 14px Lato';
        ctx.fillText('Monthly',cx,cy-10);
        ctx.fillText('Mortgage',cx,cy+10);
        ctx.font='700 16px Playfair Display';
        ctx.fillText(`$${fmt(mtg)}`,cx,cy+34);
      }

      // mortgage check handler
      chkB.addEventListener('click',()=>{
        const {ti,te,disp} = updateTotals(),
              mortgage=+mtIn.value||0,
              rent     = +document.getElementById('rent-input').value||0,
              toward   = Math.max(mortgage - rent,0),
              spare    = disp - toward,
              leftover = Math.max(spare,0),
              shortBy  = Math.abs(Math.min(spare,0));

        drawChart(rent,toward,leftover,mortgage);

        if(spare<0){
          exEl.innerHTML=`
            <p>You can‚Äôt cover a <span class="toward">$${fmt(mortgage)}</span> mortgage.</p>
            <p>You‚Äôre short <span class="shortfall">$${fmt(shortBy)}</span> per month.</p>`;
          rEl.textContent='‚ö†Ô∏è Not enough income to afford this payment.';
          rEl.style.color=cssVar('--red');
        }
        else if(spare<600){
          exEl.innerHTML=`
            <p>You already pay <span class="rent">$${fmt(rent)}</span> in rent.</p>
            <p>A <span class="toward">$${fmt(mortgage)}</span> mortgage uses 
               <span class="toward">$${fmt(toward)}</span> of your disposable income.</p>
            <p>That leaves <span class="shortfall">$${fmt(spare)}</span> to spare.</p>`;
          rEl.textContent='‚ö†Ô∏è Warning: budget is tight‚Äîconsider reducing debts or boosting income.';
          rEl.style.color=cssVar('--red');
        }
        else {
          exEl.innerHTML=`
            <p>You already pay <span class="rent">$${fmt(rent)}</span> in rent.</p>
            <p>A <span class="toward">$${fmt(mortgage)}</span> mortgage uses 
               <span class="toward">$${fmt(toward)}</span> of your disposable income.</p>
            <p>That leaves <span class="leftover">$${fmt(spare)}</span> to spare.</p>`;
          rEl.textContent='‚úÖ You could afford this payment!';
          rEl.style.color=cssVar('--green');
        }
      });

      // recalc whenever any input changes
      document.body.addEventListener('input',()=>{ if(cur<2) updateTotals(); });
      updateTotals();
    });
  </script>
</body>
</html>