<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TerraLink Affordability Wizard</title>
  <link
    href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Lato:wght@400;600&display=swap"
    rel="stylesheet"
  />
  <style>
    :root {
      --navy:      #1e2d5c;
      --green:     #2c9c7a;
      --red:       #d9534f;
      --yellow:    #f0ad4e;
      --bg-gray:   #f7f9fc;
      --text-dark: #333;
    }
    *, *::before, *::after { box-sizing: border-box; }
    body {
      margin:0;
      padding:20px;
      background: var(--bg-gray);
      color: var(--navy);
      font-family: Lato, sans-serif;
    }
    h1 {
      font-family: 'Playfair Display', serif;
      font-size: 2.5rem;
      text-align: center;
      margin-bottom: 40px;
    }
    .wizard {
      max-width: 960px;
      margin: 0 auto;
      overflow: hidden;
    }

    /* --- Progress Bar --- */
    .wizard-progress {
      display:flex;
      margin-bottom:40px;
    }
    .wizard-step {
      flex:1;
      text-align:center;
      padding:12px 0;
      font-family:'Playfair Display', serif;
      font-size:1.1rem;
      color:var(--text-dark);
      cursor:pointer;
      position:relative;
      transition:color .3s;
    }
    .wizard-step.active {
      color:var(--navy);
      font-weight:700;
    }
    .wizard-step.active::after {
      content:'';
      position:absolute;
      bottom:0; left:20%; right:20%;
      height:3px;
      background:var(--green);
      border-radius:2px;
    }

    /* --- Panels Container --- */
    .wizard-panels {
      display:flex;
      width:400%;
      transition:transform .5s ease;
    }
    .panel {
      flex:1;
      padding:50px 30px;
      min-height: 400px;
    }

    /* --- Cards & Sections --- */
    .card {
      background:#fff;
      border-radius:14px;
      box-shadow:0 6px 16px rgba(0,0,0,0.05);
      padding:24px;
      margin-bottom:36px;
    }
    .section-title {
      font-family:'Playfair Display', serif;
      font-size:1.6rem;
      color:var(--navy);
      margin-bottom:24px;
      border-bottom:2px solid var(--green);
      padding-bottom:8px;
    }

    /* --- Form Rows --- */
    .form-row {
      display:flex;
      flex-wrap:wrap;
      align-items:center;
      margin-bottom:24px;
    }
    .form-row label {
      width:140px;
      min-width:120px;
      font-weight:600;
      color:var(--text-dark);
      margin-bottom:4px;
    }
    .form-row input,
    .form-row select {
      flex:1;
      padding:12px 10px;
      font-size:16px;               /* prevent iOS zoom */
      border:none;
      border-bottom:2px solid #ccc;
      border-radius:4px;
      transition:border-color .3s,box-shadow .3s;
      background:#fff;
    }
    .form-row input:focus,
    .form-row select:focus {
      outline:none;
      border-bottom-color:var(--green);
      box-shadow:0 2px 6px rgba(44,156,122,0.3);
    }

    /* --- Toggle Switch for Pay Type --- */
    .toggle-group {
      display:flex;
      border:1px solid #ccc;
      border-radius:6px;
      overflow:hidden;
      margin-bottom:16px;
    }
    .toggle-group button {
      flex:1;
      padding:10px;
      background:#fff;
      border:none;
      font-size:1rem;
      cursor:pointer;
      transition:background .3s,color .3s;
    }
    .toggle-group button.active {
      background:var(--navy);
      color:#fff;
    }
    .toggle-group button:not(.active):hover {
      background:#f0f0f0;
    }

    /* --- Styled Select Dropdown --- */
    select.styled {
      -webkit-appearance:none;
      -moz-appearance:none;
      appearance:none;
      background: var(--bg-gray) url('data:image/svg+xml;utf8,<svg fill="%231e2d5c" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>') no-repeat right 12px center;
      background-size:16px;
    }

    /* --- Buttons --- */
    .btn {
      display:inline-block;
      padding:14px 24px;
      border:none;
      border-radius:8px;
      font-size:1rem;
      font-weight:600;
      cursor:pointer;
      transition:background .3s,transform .2s;
    }
    .btn-gold {
      background:var(--green);
      color:#fff;
    }
    .btn-gold:hover { transform:translateY(-2px); }
    .btn-navy {
      background:var(--navy);
      color:#fff;
    }
    .btn-navy:hover { transform:translateY(-2px); }

    .btn + .btn { margin-left:16px; }

    /* total displays */
    #total-income {
      font-size:2.5rem;
      color:var(--green);
      font-weight:700;
      margin-left:auto;
    }
    #total-expenses {
      font-size:2.5rem;
      color:var(--red);
      font-weight:700;
      margin-left:auto;
    }

    /* --- Summary Equation --- */
    #equation {
      display:flex;
      flex-direction:column;
      align-items:flex-start;
      gap:12px;
      margin:32px 0;
    }
    .eq-row {
      display:flex;
      justify-content:space-between;
      width:100%;
      font-size:1.6rem;
      line-height:1.2;
    }
    .eq-row span.label { flex:1; }
    .eq-row span.value { font-weight:700; }
    #eq-income  { color:var(--green); }
    #eq-exp     { color:var(--red); }
    #eq-disp    { /* dynamic */ }

    #budget-health {
      font-size:1.2rem;
      color: var(--red);
      text-align:center;
      margin-bottom:16px;
    }

    .btn-copy {
      display:inline-block;
      margin:0 auto 32px;
      padding:10px 18px;
      border:2px solid var(--navy);
      border-radius:6px;
      background:#fff;
      color:var(--navy);
      font-size:1rem;
      font-weight:600;
      cursor:pointer;
      transition:background .3s,color .3s,transform .2s;
    }
    .btn-copy:hover {
      background:var(--navy);
      color:#fff;
      transform:translateY(-2px);
    }

    .btn-row {
      display:flex;
      justify-content:space-between;
      margin-top:30px;
    }

    /* --- Chart --- */
    #chart-container {
      display:flex;
      flex-wrap:wrap;
      align-items:center;
      justify-content:center;
      gap:24px;
      margin-top:40px;
    }
    #breakdown-chart {
      width:240px;
      height:240px;
    }
    #chart-legend {
      list-style:none;
      padding:0; margin:0;
    }
    #chart-legend li {
      display:flex;
      align-items:center;
      margin-bottom:10px;
    }
    .dot {
      width:14px; height:14px;
      border-radius:50%;
      display:inline-block;
      margin-right:10px;
    }
    #affordability-explanation p {
      margin:12px 0;
      font-size:1.4rem;
      line-height:1.4;
    }
    #affordability-explanation .rent     { color:var(--red); }
    #affordability-explanation .toward   { color:var(--yellow); }
    #affordability-explanation .leftover { color:var(--green); }

    #affordability-result {
      font-size:1.4rem;
      margin-top:24px;
    }

    /* --- Responsive --- */
    @media (max-width: 480px) {
      .wizard-progress { display:none; }

      .form-row {
        flex-direction:column;
        align-items:stretch;
      }
      .form-row label {
        width:auto;
        margin-bottom:6px;
      }
      .form-row input,
      .form-row select {
        width:100%;
      }
      .btn-row {
        flex-direction:column;
        gap:12px;
      }
      .btn-row .btn {
        width:100%;
      }
      #equation {
        gap:8px; margin:24px 0;
      }
      .eq-row {
        flex-direction:column;
        align-items:flex-start;
        gap:4px;
        font-size:1.3rem;
      }
      .eq-row .value {
        font-size:1.6rem;
      }
    }
    @media (min-width: 481px) and (max-width: 768px) {
      .form-row {
        flex-direction:row;
        align-items:center;
      }
      .form-row label {
        width:140px;
        margin-bottom:0;
      }
      .btn-row { gap:16px; }
    }
    @media (min-width: 769px) {
      body { padding:40px; }
      h1 { font-size:3rem; }
    }
  </style>
</head>
<body>
  <div class="wizard">
    <h1>Find Your Path to Homeownership</h1>

    <div class="wizard-progress">
      <div class="wizard-step" data-step="0">1. Income</div>
      <div class="wizard-step" data-step="1">2. Expenses</div>
      <div class="wizard-step" data-step="2">3. Summary</div>
      <div class="wizard-step" data-step="3">4. Mortgage</div>
    </div>

    <div class="wizard-panels">
      <!-- STEP 1: INCOME -->
      <section class="panel">
        <div class="section-title">Let‚Äôs figure out your monthly income</div>
        <div id="employers-container"></div>
        <button class="btn btn-gold" id="add-employer-btn">+ Add Employer</button>

        <div class="section-title" style="margin-top:48px;">Other Income</div>
        <div id="other-income-container"></div>
        <button class="btn btn-gold" id="add-other-income-btn">+ Add Income</button>

        <div class="form-row" style="justify-content:flex-end;">
          <label>Total Monthly Income:</label><div id="total-income">$0.00</div>
        </div>

        <div class="btn-row">
          <button class="btn btn-gold next-btn">Next ‚Üí</button>
        </div>
      </section>

      <!-- STEP 2: EXPENSES -->
      <section class="panel">
        <div class="section-title">Let‚Äôs figure out your monthly expenses</div>
        <div id="expenses-container"></div>
        <button class="btn btn-gold" id="add-expense-btn">+ Add Expense</button>

        <div id="expense-selector" class="form-row" style="display:none;">
          <select id="expense-type-select" class="styled">
            <option value="car">Car Payment</option>
            <option value="credit">Credit Card</option>
            <option value="loan">Loan</option>
            <option value="child-support">Child Support</option>
            <option value="medical-bills">Medical Bills</option>
          </select>
          <button class="btn btn-navy" id="expense-type-confirm-btn">Add</button>
        </div>

        <div class="form-row expense-total-row" style="justify-content:flex-end;">
          <label>Total Monthly Expenses:</label><div id="total-expenses">$0.00</div>
        </div>

        <div class="btn-row">
          <button class="btn prev-btn">‚Üê Back</button>
          <button class="btn btn-gold next-btn">Next ‚Üí</button>
        </div>
      </section>

      <!-- STEP 3: SUMMARY -->
      <section class="panel">
        <div class="section-title">Your Disposable Income</div>
        <div id="equation">
          <div class="eq-row"><span class="label">Monthly Income</span><span class="value" id="eq-income">$0.00</span></div>
          <div class="eq-row"><span class="label">‚Äì Monthly Expenses</span><span class="value" id="eq-exp">$0.00</span></div>
          <div class="eq-row"><span class="label">= Disposable Income</span><span class="value" id="eq-disp">$0.00</span></div>
        </div>
        <div id="budget-health"></div>
        <button id="copy-btn" class="btn-copy">üìã Copy for reference</button>
        <div class="btn-row">
          <button class="btn prev-btn">‚Üê Back</button>
          <button class="btn btn-gold next-btn">Next ‚Üí</button>
        </div>
      </section>

      <!-- STEP 4: MORTGAGE -->
      <section class="panel">
        <div class="section-title">Do you have a target mortgage payment?</div>
        <div class="form-row">
          <label>Desired Mortgage:</label>
          <input type="number" id="mortgage-input" placeholder="$ / mo" min="0" step="0.01">
        </div>
        <button class="btn btn-navy" id="check-afford-btn">Check</button>

        <div id="chart-container">
          <canvas id="breakdown-chart" width="240" height="240"></canvas>
          <ul id="chart-legend"></ul>
        </div>
        <div id="affordability-explanation"></div>
        <div id="affordability-result"></div>

        <div class="btn-row">
          <button class="btn prev-btn">‚Üê Back</button>
        </div>
      </section>
    </div>
  </div>

  <script>
    /*** Helpers ***/
    const fmt = n =>
      n.toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2});
    const color = (varName) =>
      getComputedStyle(document.documentElement).getPropertyValue(varName).trim();

    /*** Wizard Navigation ***/
    document.addEventListener('DOMContentLoaded', () => {
      const steps  = [...document.querySelectorAll('.wizard-step')];
      const panels = document.querySelector('.wizard-panels');
      let current = 0;

      function showStep(idx) {
        current = idx;
        panels.style.transform = `translateX(-${(idx * 100)/steps.length}%)`;
        steps.forEach((s,i) => s.classList.toggle('active', i === idx));
        window.scrollTo({ top:0, behavior:'smooth' });
      }
      steps.forEach(s => s.addEventListener('click',()=>showStep(+s.dataset.step)));
      document.querySelectorAll('.next-btn')
        .forEach(b=>b.addEventListener('click',()=>showStep(Math.min(current+1,3))));
      document.querySelectorAll('.prev-btn')
        .forEach(b=>b.addEventListener('click',()=>showStep(Math.max(current-1,0))));
      showStep(0);

      /*** Dynamic Income Panels ***/
      let empCount=0, maxEmp=4;
      const empContainer     = document.getElementById('employers-container');
      const addEmpBtn        = document.getElementById('add-employer-btn');

      function addEmployerCard() {
        if(empCount >= maxEmp) return;
        empCount++;
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <div class="section-title">Employer ${empCount}</div>
          <div class="form-row"><label>Pay Type:</label>
            <div class="toggle-group">
              <button class="toggle-hourly active">Hourly</button>
              <button class="toggle-salary">Salary</button>
            </div>
          </div>
          <div class="form-row row-hourly">
            <label>Hourly Rate ($):</label><input type="number" class="hourly-rate" min="0" step="0.01">
          </div>
          <div class="form-row row-hourly">
            <label>Hours/Week:</label><input type="number" class="hours-per-week" min="0" step="0.1">
          </div>
          <div class="form-row row-salary" style="display:none;">
            <label>Annual Salary ($):</label><input type="number" class="annual-salary" min="0" step="1">
          </div>
          <div class="form-row">
            <label>Monthly Income:</label><span class="monthly-display">$0.00</span>
          </div>
        `;
        empContainer.appendChild(card);

        // Toggle logic
        const btnHourly = card.querySelector('.toggle-hourly');
        const btnSalary = card.querySelector('.toggle-salary');
        const rowHourly = card.querySelectorAll('.row-hourly');
        const rowSalary = card.querySelector('.row-salary');

        btnHourly.addEventListener('click',()=>{
          btnHourly.classList.add('active');
          btnSalary.classList.remove('active');
          rowHourly.forEach(r=>r.style.display='flex');
          rowSalary.style.display='none';
          updateTotals();
        });
        btnSalary.addEventListener('click',()=>{
          btnSalary.classList.add('active');
          btnHourly.classList.remove('active');
          rowHourly.forEach(r=>r.style.display='none');
          rowSalary.style.display='flex';
          updateTotals();
        });

        addEmpBtn.disabled = empCount === maxEmp;
      }
      addEmpBtn.addEventListener('click',addEmployerCard);
      addEmployerCard(); // start with 1

      /*** Other Income ***/
      const othContainer = document.getElementById('other-income-container');
      const addOthBtn    = document.getElementById('add-other-income-btn');
      function addOtherIncomeRow() {
        const row = document.createElement('div');
        row.className = 'form-row';
        row.innerHTML = `
          <label>&nbsp;</label>
          <select class="other-income-type styled">
            <option>Social Security</option>
            <option>Retirement</option>
            <option>Disability</option>
            <option>Alimony</option>
            <option>Other Income</option>
          </select>
          <input type="number" class="other-income-input" placeholder="Monthly Amount" min="0" step="0.01">
        `;
        othContainer.appendChild(row);
      }
      addOthBtn.addEventListener('click',addOtherIncomeRow);
      addOtherIncomeRow();

      /*** Expenses ***/
      const expContainer = document.getElementById('expenses-container');
      const addExpBtn    = document.getElementById('add-expense-btn');
      const selExpRow    = document.getElementById('expense-selector');
      const selExpType   = document.getElementById('expense-type-select');
      const confirmExp   = document.getElementById('expense-type-confirm-btn');

      let expCount = { car:0, credit:0, loan:0, 'child-support':0, 'medical-bills':0 };
      const expLimit   = { car:2, credit:10, loan:10, 'child-support':5, 'medical-bills':5 };

      function addBaseExpense(label, id) {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <div class="section-title">${label}</div>
          <div class="form-row">
            <label>Amount:</label>
            <input type="number" id="${id}-input" class="expense-input" placeholder="Monthly ${label}" min="0" step="0.01">
          </div>
        `;
        expContainer.appendChild(card);
      }
      // initial fixed ones
      addBaseExpense('Rent',          'rent');
      addBaseExpense('Car Payment',   'car-1');
      addBaseExpense('Credit Card',   'credit-1');
      addBaseExpense('Loan',          'loan-1');

      function addDynamicExpense(type) {
        if(expCount[type] >= expLimit[type]) return;
        expCount[type]++;
        let label;
        switch(type){
          case 'car': label='Car Payment'; break;
          case 'credit': label='Credit Card'; break;
          case 'loan': label='Loan'; break;
          case 'child-support': label='Child Support'; break;
          default: label='Medical Bills';
        }
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <div class="section-title">${label} ${expCount[type]+1}</div>
          <div class="form-row">
            <label>Amount:</label>
            <input type="number" class="expense-input" placeholder="Monthly ${label}" min="0" step="0.01">
          </div>
        `;
        expContainer.appendChild(card);
        if(expCount[type] >= expLimit[type]) {
          selExpType.querySelector(`option[value="${type}"]`).disabled = true;
        }
      }

      addExpBtn.addEventListener('click', ()=> selExpRow.style.display='flex');
      confirmExp.addEventListener('click', ()=>{
        addDynamicExpense(selExpType.value);
        selExpRow.style.display = 'none';
      });

      /*** Totals & Summary Logic ***/
      const totalIncEl = document.getElementById('total-income');
      const totalExpEl = document.getElementById('total-expenses');
      const eqIncome   = document.getElementById('eq-income');
      const eqExp      = document.getElementById('eq-exp');
      const eqDisp     = document.getElementById('eq-disp');
      const budgetHealth = document.getElementById('budget-health');

      function updateTotals(){
        // Income
        let totalIncome = 0;
        document.querySelectorAll('.card').forEach(card => {
          const dispSpan = card.querySelector('.monthly-display');
          if(!dispSpan) return;
          const isSalary = card.querySelector('.toggle-salary').classList.contains('active');
          let monthly = 0;
          if(isSalary) {
            const annual = parseFloat(card.querySelector('.annual-salary').value) || 0;
            monthly = annual / 12;
          } else {
            const rate = parseFloat(card.querySelector('.hourly-rate').value) || 0;
            const hrs  = parseFloat(card.querySelector('.hours-per-week').value) || 0;
            monthly = rate * hrs * 52 / 12;
          }
          totalIncome += monthly;
          dispSpan.textContent = '$' + fmt(monthly);
        });
        // Other income
        document.querySelectorAll('.other-income-input').forEach(i=>{
          totalIncome += parseFloat(i.value) || 0;
        });
        totalIncEl.textContent = '$' + fmt(totalIncome);

        // Expenses
        let totalExpenses = 0;
        document.querySelectorAll('.expense-input').forEach(i=>{
          totalExpenses += parseFloat(i.value) || 0;
        });
        totalExpEl.textContent = '$' + fmt(totalExpenses);

        // Disposable
        const disp = totalIncome - totalExpenses;
        eqIncome.textContent = '$' + fmt(totalIncome);
        eqExp.textContent    = '$' + fmt(totalExpenses);
        eqDisp.textContent   = '$' + fmt(disp);
        if(disp < 0) {
          eqDisp.style.color = color('--red');
        } else {
          eqDisp.style.color = color('--green');
        }

        // Health warning
        if(disp < 600) {
          budgetHealth.textContent = '‚ö†Ô∏è Your disposable income is under $600/mo. Consider reducing debts or increasing income.';
        } else {
          budgetHealth.textContent = '';
        }

        return { totalIncome, totalExpenses, disp };
      }

      // live update
      document.body.addEventListener('input', () => {
        if(current < 2) updateTotals();
      });
      updateTotals();

      // Copy button
      document.getElementById('copy-btn').addEventListener('click', async ()=>{
        const txt = [
          `Monthly Income: ${eqIncome.textContent}`,
          `Monthly Expenses: ${eqExp.textContent}`,
          `Disposable Income: ${eqDisp.textContent}`
        ].join('\n');
        await navigator.clipboard.writeText(txt);
        const btn = document.getElementById('copy-btn');
        btn.textContent = '‚úÖ Copied!';
        btn.disabled = true;
        setTimeout(()=>{
          btn.textContent = 'üìã Copy for reference';
          btn.disabled = false;
        }, 2000);
      });

      /*** Mortgage Affordability ***/
      const mortgageInput = document.getElementById('mortgage-input');
      const checkBtn      = document.getElementById('check-afford-btn');
      const ctx           = document.getElementById('breakdown-chart').getContext('2d');
      const legendEl      = document.getElementById('chart-legend');
      const explainEl     = document.getElementById('affordability-explanation');
      const resultEl      = document.getElementById('affordability-result');

      function drawDonut(rent, toward, leftover, target) {
        const data = [rent, toward, leftover];
        const total = data.reduce((a,b)=>a+b,0) || 1;
        const colors = [color('--red'), color('--yellow'), color('--green')];
        const labels = ['Rent','Toward Mortgage','Leftover'];
        const centerX = 120, centerY = 120, radius = 100;
        ctx.clearRect(0,0,240,240);
        legendEl.innerHTML = '';
        let start = -Math.PI/2;
        data.forEach((v,i)=>{
          const slice = (v/total)*2*Math.PI;
          ctx.beginPath();
          ctx.strokeStyle = colors[i];
          ctx.lineWidth = 24;
          ctx.arc(centerX, centerY, radius, start, start+slice);
          ctx.stroke();
          start += slice;
          // legend
          const li = document.createElement('li');
          const pct = Math.round(v/total*100);
          li.innerHTML = `<span class="dot" style="background:${colors[i]}"></span>
                          ${labels[i]} $${fmt(v)} (${pct}%)`;
          legendEl.appendChild(li);
        });
        // center text
        ctx.fillStyle = color('--navy');
        ctx.textAlign = 'center';
        ctx.font = '600 16px Lato';
        ctx.fillText('Monthly',centerX,centerY-8);
        ctx.fillText('Mortgage',centerX,centerY+8);
        ctx.font = '700 18px Playfair Display';
        ctx.fillText(`$${fmt(target)}`, centerX, centerY+32);
      }

      checkBtn.addEventListener('click', ()=>{
        const { totalIncome, totalExpenses, disp } = updateTotals();
        const rentAmt = parseFloat(document.getElementById('rent-input').value) || 0;
        const target  = parseFloat(mortgageInput.value) || 0;
        const towards = Math.max(0, target - rentAmt);
        const leftover = Math.max(0, disp - towards);

        drawDonut(rentAmt, towards, leftover, target);

        // build explanation text
        explainEl.innerHTML = [
          `You already pay <span class="rent">$${fmt(rentAmt)}</span> in rent.`,
          `A <span class="toward">$${fmt(target)}</span> mortgage uses <span class="toward">$${fmt(towards)}</span> of your disposable income.`,
          `That leaves <span class="leftover">$${fmt(leftover)}</span> to spare.`
        ].map(p=>`<p>${p}</p>`).join('');

        // outcome message
        if(disp < towards) {
          const shortBy = fmt(towards - disp);
          resultEl.innerHTML = `‚ö†Ô∏è Not enough income to afford this payment. You are short <span class="shortfall">$${shortBy}</span> per month.`;
          resultEl.style.color = color('--red');
        } else {
          resultEl.innerHTML = `‚úÖ You could afford this payment!`;
          resultEl.style.color = color('--green');
        }
      });

    });
  </script>
</body>
</html>